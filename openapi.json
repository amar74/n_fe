{
  "openapi": "3.0.3",
  "info": {
    "title": "Megapolis Finance API",
    "version": "0.1.0",
    "description": "Finance module endpoints covering dashboard and planning experiences."
  },
  "servers": [
    {
      "url": "http://127.0.0.1:8000",
      "description": "Development server"
    }
  ],
  "paths": {
    "/api/v1/finance/dashboard/summary": {
      "get": {
        "summary": "Finance dashboard summary",
        "tags": ["Finance Dashboard"],
        "operationId": "finance_getDashboardSummary",
        "parameters": [
          {
            "name": "business_unit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["firmwide", "business_unit_a", "business_unit_b"]
            },
            "description": "Business unit filter. Defaults to firmwide view."
          }
        ],
        "responses": {
          "200": {
            "description": "Dashboard summary payload",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FinanceDashboardSummaryResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/finance/dashboard/overhead": {
      "get": {
        "summary": "Overhead spend by account group",
        "tags": ["Finance Dashboard"],
        "operationId": "finance_getOverheadByAccountGroup",
        "parameters": [
          {
            "name": "business_unit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["firmwide", "business_unit_a", "business_unit_b"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Overhead spend results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FinanceOverheadResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/finance/dashboard/bookings": {
      "get": {
        "summary": "Bookings vs plan by client",
        "tags": ["Finance Dashboard"],
        "operationId": "finance_getBookingsProgress",
        "parameters": [
          {
            "name": "business_unit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["firmwide", "business_unit_a", "business_unit_b"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Bookings attainment data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FinanceBookingsResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/finance/dashboard/trends": {
      "get": {
        "summary": "Year-over-year trends",
        "tags": ["Finance Dashboard"],
        "operationId": "finance_getTrends",
        "parameters": [
          {
            "name": "business_unit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": ["firmwide", "business_unit_a", "business_unit_b"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Historical trend metrics",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FinanceTrendResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/finance/planning/annual": {
      "get": {
        "summary": "Annual planning snapshot",
        "tags": ["Finance Planning"],
        "operationId": "finance_getAnnualPlanningData",
        "responses": {
          "200": {
            "description": "Annual planning payload",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FinancePlanningAnnualResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/finance/planning/scenarios": {
      "get": {
        "summary": "Scenario planning snapshot",
        "tags": ["Finance Planning"],
        "operationId": "finance_getScenarioPlanningData",
        "responses": {
          "200": {
            "description": "Scenario planning payload",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FinancePlanningScenarioResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "FinanceDashboardMetric": {
        "type": "object",
        "required": ["label", "value"],
        "properties": {
          "label": {
            "type": "string"
          },
          "value": {
            "type": "number",
            "format": "double"
          },
          "formatted": {
            "type": "string"
          },
          "trendPercent": {
            "type": "number",
            "format": "double"
          },
          "trendLabel": {
            "type": "string"
          }
        }
      },
      "FinanceDashboardSummaryResponse": {
        "type": "object",
        "required": ["period", "primaryMetrics", "kpiProgress", "aiHighlights", "businessUnits", "receivables"],
        "properties": {
          "period": {
            "type": "string",
            "description": "ISO date or year-month boundary for the snapshot."
          },
          "primaryMetrics": {
            "type": "object",
            "required": ["netRevenueYtd", "operatingIncomeCurrent", "cashPosition", "droDays"],
            "properties": {
              "netRevenueYtd": {
                "$ref": "#/components/schemas/FinanceDashboardMetric"
              },
              "operatingIncomeCurrent": {
                "$ref": "#/components/schemas/FinanceDashboardMetric"
              },
              "cashPosition": {
                "$ref": "#/components/schemas/FinanceDashboardMetric"
              },
              "droDays": {
                "$ref": "#/components/schemas/FinanceDashboardMetric"
              }
            }
          },
          "kpiProgress": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["label", "value", "percentComplete"],
              "properties": {
                "label": {
                  "type": "string"
                },
                "value": {
                  "type": "string"
                },
                "percentComplete": {
                  "type": "number",
                  "format": "double"
                },
                "target": {
                  "type": "number",
                  "format": "double"
                }
              }
            }
          },
          "aiHighlights": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["title", "tone", "detail"],
              "properties": {
                "title": {
                  "type": "string"
                },
                "tone": {
                  "type": "string",
                  "enum": ["positive", "warning", "critical"]
                },
                "detail": {
                  "type": "string"
                }
              }
            }
          },
          "businessUnits": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name", "netRevenueSharePercent", "netRevenue", "operatingIncome"],
              "properties": {
                "name": {
                  "type": "string"
                },
                "netRevenueSharePercent": {
                  "type": "number",
                  "format": "double"
                },
                "netRevenue": {
                  "type": "number",
                  "format": "double"
                },
                "operatingIncome": {
                  "type": "number",
                  "format": "double"
                }
              }
            }
          },
          "receivables": {
            "type": "object",
            "required": ["dro", "dbo", "duo", "insight"],
            "properties": {
              "dro": {
                "type": "number",
                "format": "double"
              },
              "dbo": {
                "type": "number",
                "format": "double"
              },
              "duo": {
                "type": "number",
                "format": "double"
              },
              "insight": {
                "type": "string"
              }
            }
          }
        }
      },
      "FinanceOverheadItem": {
        "type": "object",
        "required": ["category", "ytdSpend", "monthlyAverage"],
        "properties": {
          "category": {
            "type": "string"
          },
          "ytdSpend": {
            "type": "number",
            "format": "double"
          },
          "monthlyAverage": {
            "type": "number",
            "format": "double"
          }
        }
      },
      "FinanceOverheadResponse": {
        "type": "object",
        "required": ["totalYtd", "topCategory", "bottomCategory", "categories"],
        "properties": {
          "totalYtd": {
            "type": "number",
            "format": "double"
          },
          "topCategory": {
            "$ref": "#/components/schemas/FinanceOverheadItem"
          },
          "bottomCategory": {
            "$ref": "#/components/schemas/FinanceOverheadItem"
          },
          "categories": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/FinanceOverheadItem"
            }
          }
        }
      },
      "FinanceBookingRecord": {
        "type": "object",
        "required": ["clientName", "ytdActual", "planTotal", "progressPercent", "remaining"],
        "properties": {
          "clientName": {
            "type": "string"
          },
          "ytdActual": {
            "type": "number",
            "format": "double"
          },
          "planTotal": {
            "type": "number",
            "format": "double"
          },
          "progressPercent": {
            "type": "number",
            "format": "double"
          },
          "remaining": {
            "type": "number",
            "format": "double"
          }
        }
      },
      "FinanceBookingsResponse": {
        "type": "object",
        "required": ["averageAttainmentPercent", "leader", "laggard", "records"],
        "properties": {
          "averageAttainmentPercent": {
            "type": "number",
            "format": "double"
          },
          "leader": {
            "$ref": "#/components/schemas/FinanceBookingRecord"
          },
          "laggard": {
            "$ref": "#/components/schemas/FinanceBookingRecord"
          },
          "records": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/FinanceBookingRecord"
            }
          }
        }
      },
      "FinanceTrendPoint": {
        "type": "object",
        "required": ["year", "value"],
        "properties": {
          "year": {
            "type": "integer",
            "format": "int32"
          },
          "value": {
            "type": "number",
            "format": "double"
          }
        }
      },
      "FinanceTrendMetric": {
        "type": "object",
        "required": ["metric", "points", "cagrPercent"],
        "properties": {
          "metric": {
            "type": "string",
            "description": "Metric identifier, e.g., net_revenue, gross_profit."
          },
          "points": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/FinanceTrendPoint"
            }
          },
          "cagrPercent": {
            "type": "number",
            "format": "double"
          }
        }
      },
      "FinanceTrendResponse": {
        "type": "object",
        "required": ["metrics"],
        "properties": {
          "metrics": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/FinanceTrendMetric"
            }
          }
        }
      },
      "FinancePlanningMetric": {
        "type": "object",
        "required": ["label"],
        "properties": {
          "label": {
            "type": "string"
          },
          "value": {
            "type": "number",
            "format": "double"
          },
          "valueLabel": {
            "type": "string"
          },
          "tone": {
            "type": "string",
            "enum": ["default", "positive", "negative", "accent"],
            "default": "default"
          }
        }
      },
      "FinancePlanningAnnualResponse": {
        "type": "object",
        "required": ["budgetSummary", "revenueLines", "expenseLines", "businessUnits", "varianceThresholds", "reportingSchedule", "aiHighlights"],
        "properties": {
          "budgetSummary": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/FinancePlanningMetric"
            }
          },
          "revenueLines": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["label", "target", "variance"],
              "properties": {
                "label": {
                  "type": "string"
                },
                "target": {
                  "type": "number",
                  "format": "double"
                },
                "variance": {
                  "type": "number",
                  "format": "double"
                }
              }
            }
          },
          "expenseLines": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["label", "target", "variance"],
              "properties": {
                "label": {
                  "type": "string"
                },
                "target": {
                  "type": "number",
                  "format": "double"
                },
                "variance": {
                  "type": "number",
                  "format": "double"
                }
              }
            }
          },
          "businessUnits": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name", "revenue", "expense", "profit", "headcount", "marginPercent"],
              "properties": {
                "name": {
                  "type": "string"
                },
                "revenue": {
                  "type": "number",
                  "format": "double"
                },
                "expense": {
                  "type": "number",
                  "format": "double"
                },
                "profit": {
                  "type": "number",
                  "format": "double"
                },
                "headcount": {
                  "type": "integer",
                  "format": "int32"
                },
                "marginPercent": {
                  "type": "number",
                  "format": "double"
                }
              }
            }
          },
          "varianceThresholds": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["label", "valuePercent"],
              "properties": {
                "label": {
                  "type": "string"
                },
                "valuePercent": {
                  "type": "number",
                  "format": "double"
                }
              }
            }
          },
          "reportingSchedule": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["label", "value"],
              "properties": {
                "label": {
                  "type": "string"
                },
                "value": {
                  "type": "string"
                }
              }
            }
          },
          "aiHighlights": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["title", "tone", "detail"],
              "properties": {
                "title": {
                  "type": "string"
                },
                "tone": {
                  "type": "string",
                  "enum": ["positive", "warning", "critical"]
                },
                "detail": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "FinancePlanningScenarioResponse": {
        "type": "object",
        "required": ["scenarios", "planningConfiguration", "projections", "kpiTargets", "timeline", "tasks", "aiPlaybook"],
        "properties": {
          "scenarios": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["key", "name", "description", "growthRates", "investmentLevel", "bonusThreshold", "riskLevel"],
              "properties": {
                "key": {
                  "type": "string"
                },
                "name": {
                  "type": "string"
                },
                "description": {
                  "type": "string"
                },
                "growthRates": {
                  "type": "array",
                  "items": {
                    "type": "number",
                    "format": "double"
                  }
                },
                "investmentLevel": {
                  "type": "string",
                  "enum": ["Low", "Medium", "High"]
                },
                "bonusThreshold": {
                  "type": "number",
                  "format": "double"
                },
                "riskLevel": {
                  "type": "string",
                  "enum": ["Low", "Medium", "High"]
                },
                "active": {
                  "type": "boolean",
                  "default": false
                }
              }
            }
          },
          "planningConfiguration": {
            "type": "object",
            "required": ["planningPeriodYears", "baseYearRevenue", "baseYearExpenses"],
            "properties": {
              "planningPeriodYears": {
                "type": "integer",
                "format": "int32"
              },
              "baseYearRevenue": {
                "type": "number",
                "format": "double"
              },
              "baseYearExpenses": {
                "type": "number",
                "format": "double"
              }
            }
          },
          "projections": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["year", "revenue", "expenses", "profit", "marginPercent"],
              "properties": {
                "year": {
                  "type": "integer",
                  "format": "int32"
                },
                "revenue": {
                  "type": "number",
                  "format": "double"
                },
                "expenses": {
                  "type": "number",
                  "format": "double"
                },
                "profit": {
                  "type": "number",
                  "format": "double"
                },
                "marginPercent": {
                  "type": "number",
                  "format": "double"
                }
              }
            }
          },
          "kpiTargets": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["year", "kpis"],
              "properties": {
                "year": {
                  "type": "integer",
                  "format": "int32"
                },
                "kpis": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["label", "value"],
                    "properties": {
                      "label": {
                        "type": "string"
                      },
                      "value": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          },
          "timeline": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["title", "date", "status"],
              "properties": {
                "title": {
                  "type": "string"
                },
                "date": {
                  "type": "string",
                  "format": "date"
                },
                "status": {
                  "type": "string"
                }
              }
            }
          },
          "tasks": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["title", "owner", "due", "status"],
              "properties": {
                "title": {
                  "type": "string"
                },
                "owner": {
                  "type": "string"
                },
                "due": {
                  "type": "string"
                },
                "status": {
                  "type": "string",
                  "enum": ["Planned", "In Progress", "Behind", "Completed"]
                }
              }
            }
          },
          "aiPlaybook": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["title", "insight"],
              "properties": {
                "title": {
                  "type": "string"
                },
                "insight": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    }
  }
}
